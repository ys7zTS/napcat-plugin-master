# NapCat Master Plugin (napcat-plugin-master)

è¿™æ˜¯ä¸€ä¸ªåŸºäº NapCat çš„ä¸»äººç®¡ç†æ’ä»¶æ¨¡æ¿ã€‚å®ƒæä¾›äº†åŸºç¡€çš„ä¸»äººæƒé™æ ¡éªŒã€ä¸»äººåˆ—è¡¨ç®¡ç†åŠŸèƒ½ï¼Œå¹¶æ”¯æŒé€šè¿‡ WebUI è¿›è¡Œå¯è§†åŒ–é…ç½®ã€‚

## ğŸ“ é¡¹ç›®ç»“æ„

```
src/
â”œâ”€â”€ index.ts              # æ’ä»¶å…¥å£ï¼Œæä¾›ç”Ÿå‘½å‘¨æœŸé’©å­å¹¶å¯¼å‡º isMaster/getMasterList
â”œâ”€â”€ master.ts             # ä¸»äººç®¡ç†æ ¸å¿ƒé€»è¾‘ (Masters ç±»)
â”œâ”€â”€ plugin.ts             # æ’ä»¶ç®¡ç†ä¸æŒ‡ä»¤åˆ†å‘ (PluginManager ç±»)
â”œâ”€â”€ Routes.ts             # WebUI API è·¯ç”±æ³¨å†Œ
â”œâ”€â”€ func.ts               # å…·ä½“åŠŸèƒ½å¤„ç†å‡½æ•°
â”œâ”€â”€ types.ts              # TypeScript ç±»å‹å®šä¹‰
â”œâ”€â”€ utils.ts              # å·¥å…·å‡½æ•° (å¦‚æ¶ˆæ¯å›å¤)
â””â”€â”€ webui/                # React SPA å‰ç«¯æºç 
```

## âœ¨ åŠŸèƒ½ç‰¹æ€§

- **ä¸»äººç®¡ç†**ï¼šç»´æŠ¤ä¸€ä¸ªä¸»äºº QQ åˆ—è¡¨ï¼Œç”¨äºæƒé™æ ¡éªŒã€‚æ”¯æŒæŒä¹…åŒ–å­˜å‚¨åˆ° `masters.json`ã€‚
- **æ’ä»¶é—´é€šä¿¡**ï¼šé€šè¿‡å¯¼å‡º `isMaster` å’Œ `getMasterList` å‡½æ•°ï¼Œè®©å…¶ä»–æ’ä»¶èƒ½å¤Ÿç»Ÿä¸€è°ƒç”¨æœ¬æ’ä»¶çš„æƒé™åˆ¤æ–­ã€‚
- **WebUI ç•Œé¢**ï¼šé›†æˆ React ç¼–å†™çš„ç®¡ç†åå°ï¼Œæ”¯æŒç›´æ¥åœ¨ç½‘é¡µç«¯æŸ¥çœ‹ä¸å¢åˆ ä¸»äººã€‚
- **çƒ­é‡è½½æ”¯æŒ**ï¼šé›†æˆ `napcat-plugin-debug`ï¼Œæ”¯æŒå¼€å‘è¿‡ç¨‹ä¸­çš„è‡ªåŠ¨æ„å»ºä¸é‡è½½ã€‚

## ğŸ”Œ æ’ä»¶é—´é€šä¿¡ (å¼€å‘è€…å¿…è¯»)

æ ¹æ® [NapCat å®˜æ–¹æ–‡æ¡£ - æ’ä»¶é—´é€šä¿¡](https://napneko.github.io/develop/plugin/advanced#_3-%E6%8F%92%E4%BB%B6%E9%97%B4%E9%80%9A%E4%BF%A1)ï¼Œæœ¬æ’ä»¶å¯¼å‡ºäº†ä¸¤ä¸ªæ ¸å¿ƒå‡½æ•°ä¾›å…¶ä»–æ’ä»¶è°ƒç”¨ã€‚

### å¯¼å‡ºå‡½æ•°

- `isMaster(userId: string): boolean`: æ£€æŸ¥æŒ‡å®šç”¨æˆ·æ˜¯å¦åœ¨ä¸»äººåˆ—è¡¨ä¸­ã€‚
- `getMasterList(): string[]`: è·å–å½“å‰æ‰€æœ‰ä¸»äººçš„ QQ å·æ•°ç»„ã€‚

### è°ƒç”¨ç¤ºä¾‹

åœ¨ä½ çš„æ’ä»¶ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡ `ctx.getPluginExports` è·å–æœ¬æ’ä»¶çš„å¯¼å‡ºæ¥å£ï¼š

```typescript
// 1. å®šä¹‰å¯¼å‡ºæ¥å£ï¼ˆå¯é€‰ï¼Œå»ºè®®æ”¾åœ¨ä½ çš„ types.ts ä¸­ï¼‰
interface MasterPluginExports {
  isMaster: (userId: string) => boolean;
  getMasterList: () => string[];
}

// 2. åœ¨ plugin_init æˆ–å…¶ä»–ç”Ÿå‘½å‘¨æœŸä¸­è·å–
// 'napcat-plugin-master' æ˜¯æœ¬æ’ä»¶åœ¨ package.json ä¸­å®šä¹‰çš„ name å­—æ®µ
// å¦‚æœä½ ä¿®æ”¹äº† package.json ä¸­çš„ nameï¼Œè¯·ç›¸åº”ä¿®æ”¹æ­¤å¤„çš„å­—ç¬¦ä¸²
const masterApi = ctx.getPluginExports<MasterPluginExports>('napcat-plugin-master');

if (masterApi) {
  // 3. ä½¿ç”¨ API
  const userId = event.user_id.toString();
  
  // ç¤ºä¾‹ï¼šä»…å…è®¸ä¸»äººæ‰§è¡Œçš„æ“ä½œ
  if (masterApi.isMaster(userId)) {
    console.log('æ£€æµ‹åˆ°ä¸»äººæƒé™ï¼Œå…è®¸æ‰§è¡Œæ•æ„Ÿæ“ä½œ');
  }

  // ç¤ºä¾‹ï¼šåˆ—å‡ºæ‰€æœ‰ä¸»äºº
  const allMasters = masterApi.getMasterList();
  console.log('å½“å‰æ‰€æœ‰ä¸»äºº QQ:', allMasters);
}
```

## ğŸ›  å¼€å‘ä¸æ„å»º

### ç¯å¢ƒå‡†å¤‡

```bash
pnpm install
```

### å®Œæ•´æ„å»º

```bash
# åŒæ—¶æ„å»ºåç«¯ (src) ä¸å‰ç«¯ (src/webui)
pnpm run build
```

### å¼€å‘è°ƒè¯•

æœ¬é¡¹ç›®æ”¯æŒçƒ­é‡è½½è°ƒè¯•ã€‚ç¡®ä¿ NapCat ç«¯å·²å®‰è£…å¹¶å¯ç”¨ `napcat-plugin-debug` æ’ä»¶ï¼Œç„¶åè¿è¡Œï¼š

```bash
# å¯åŠ¨ watch æ¨¡å¼å¹¶è‡ªåŠ¨éƒ¨ç½²çƒ­é‡è½½
pnpm run dev
```

## ğŸš€ éƒ¨ç½²

### è‡ªåŠ¨éƒ¨ç½² (æ¨è)

åœ¨ `vite.config.ts` ä¸­é…ç½®å¥½è°ƒè¯•æœåŠ¡çš„ `wsUrl` å’Œ `token` åï¼Œä½¿ç”¨ `pnpm run dev` å³å¯åœ¨ä¿å­˜ä»£ç æ—¶è‡ªåŠ¨åŒæ­¥åˆ°è¿œç¨‹ NapCat å¹¶é‡è½½æ’ä»¶ã€‚

### æ‰‹åŠ¨éƒ¨ç½²

1. æ‰§è¡Œ `pnpm run build`ã€‚
2. å°†ç”Ÿæˆçš„ `dist/` ç›®å½•å†…å®¹æ•´ä½“å¤åˆ¶åˆ° NapCat çš„ `plugins/` ç›®å½•ä¸‹ï¼ˆé€šå¸¸é‡å‘½åä¸ºæ’ä»¶æ–‡ä»¶å¤¹åï¼‰ã€‚

## ğŸŒ WebUI API

æ’ä»¶å†…ç½®äº† API è·¯ç”±ï¼ˆç”± `src/Routes.ts` æ³¨å†Œï¼‰ï¼š

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
| :--- | :--- | :--- |
| GET | `/masters` | è·å–æ‰€æœ‰ä¸»äººåˆ—è¡¨ |
| POST | `/masters/add` | æ·»åŠ æ–°ä¸»äºº (å‚æ•°: `{ "userId": "QQå·" }`) |
| POST | `/masters/remove` | ç§»é™¤ä¸»äºº (å‚æ•°: `{ "userId": "QQå·" }`) |

è¿™äº› API è¢«å‰ç«¯ WebUI è°ƒç”¨ï¼Œä¹Ÿå¯ç”¨äºå…¶ä»–è‡ªåŠ¨åŒ–ç®¡ç†åœºæ™¯ã€‚

## ğŸ“„ è®¸å¯è¯

MIT
